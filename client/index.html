<!DOCTYPE html>
<html>
<head>
	<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
</head>

<body>
      <div id="fb-root"></div>
      <script>
      fbid = '';

        window.fbAsyncInit = function() {
          FB.init({
            appId      : '451362761628856',
            status     : true, 
            cookie     : true,
            xfbml      : true,
            oauth      : true,
          });
        };
        (function(d){
           var js, id = 'facebook-jssdk'; if (d.getElementById(id)) {return;}
           js = d.createElement('script'); js.id = id; js.async = true;
           js.src = "//connect.facebook.net/en_US/all.js";
           d.getElementsByTagName('head')[0].appendChild(js);
         }(document));

       //LOGIN FUNCTION 
       function login() {
        FB.login(function(response) {
            if (response.authResponse) {
                alert('Success!');
                console.log(response.authResponse);
                fbid = response.authResponse.userID;
                $('#bump').show();
            }else{
                alert('Login Failed!');
            }
        }, {scope: 'email'});
     }
      </script>

      

      <div style='background:blue;color:white;width=100%;height=20%' onclick="login();" >
      	<h1>Login with Facebook</h1>
      </div>

      <div id="bump" style='background:blue;color:white;width=100%;height=20%' onclick='performBump();'><em>BUMP</em></div> 
 


	<div class="main">
	  <h2>Device Motion</h2>
	  <table>
	    <tr>
	      <td>Event Supported</td>
	      <td id="dmEvent"></td>
	    </tr>
	    <tr>
	      <td>acceleration</td>
	      <td id="acc"></td>
	    </tr>
	    <tr>
	      <td>magnitude</td>
	      <td id="magnitude"></td>
	    </tr>
	    <tr>
	      <td>interval</td>
	      <td id="moInterval"></td>
	    </tr>
	    <tr>
	      <td>geolocation</td>
	      <td id="geo"></td>
	    </tr>
	    <tr>
	      <td>timeStamp</td>
	      <td id="timestamp"></td>
	    </tr>
	  </table>
	</div>


	 <script>
      	function getLocation() {
		  if (navigator.geolocation) {
		    navigator.geolocation.getCurrentPosition(function(position){
		    	var geo = position.coords.longitude + "," + position.coords.latitude;
		    	$("#geo").html= geo;
		    	return geo;
		    });
		  }
		  else {
		  	$("#geo").html="Geolocation is not supported by this browser.";
		   } 
		}

		function getTimeStamp(){
			document.getElementById("timestamp").innerHTML = (new Date().getTime());
		}

		mcnt = 0.0;
		function deviceMotionHandler(eventData) {
		  var info, xyz = "[X, Y, Z]";

		  // Grab the acceleration from the results
		  var acc = eventData.acceleration;
		  info = xyz.replace("X", acc.x);
		  info = info.replace("Y", acc.y);
		  info = info.replace("Z", acc.z);
		  document.getElementById("acc").innerHTML = info;

		  var magnitude = Math.sqrt(acc.x*acc.x + acc.y*acc.y + acc.z*acc.z);
		  document.getElementById("magnitude").innerHTML = magnitude;

		  
		  //BUMP logic
		  if (magnitude > 1.4) {
		  	mcnt += eventData.interval;
		  }

		  if (mcnt > 1.0) {		
		  	var location = getLocation();
		  	var timestamp = getTimeStamp();

		  	alert(fbid + timestamp + location);
		  	window.removeEventListener('devicemotion', deviceMotionHandler);

		  	mcnt = 0.0;
		  }


		  // // Grab the refresh interval from the results
		  info = eventData.interval;
		  document.getElementById("moInterval").innerHTML = info;       
		};

		$('#bump').hide();

      	function performBump(){

			if (window.DeviceMotionEvent) {
			  window.addEventListener('devicemotion', deviceMotionHandler, false);
			} else {
			  document.getElementById("dmEvent").innerHTML = "Not supported."
			}
      	};





    </script>

</body>

</html>