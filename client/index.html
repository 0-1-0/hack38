<!DOCTYPE html>
<html>
<head>
</head>

<body>

	<div id="fb-root"></div>
	<script>
	  window.fbAsyncInit = function() {
	    // init the FB JS SDK
	    FB.init({
	      appId      : '451362761628856',                   // App ID from the app dashboard
	      status     : true, 
	      cookie     : true,
	      xfbml      : true,
	      oauth      : true                              // Check Facebook Login status
	    });

	    // Additional initialization code such as adding Event Listeners goes here
	    FB.login(function(response) {
		   if (response.authResponse) {
		     console.log('Welcome!  Fetching your information.... ');
		     FB.api('/me', function(response) {
		       console.log('Good to see you, ' + response.name + '.');
		     });
		   } else {
		     console.log('User cancelled login or did not fully authorize.');
		   }
		});
	  };

	  // Load the SDK asynchronously
	  (function(d, s, id){
	     var js, fjs = d.getElementsByTagName(s)[0];
	     if (d.getElementById(id)) {return;}
	     js = d.createElement(s); js.id = id;
	     js.src = "//connect.facebook.net/en_US/all.js";
	     fjs.parentNode.insertBefore(js, fjs);
	   }(document, 'script', 'facebook-jssdk'));
	</script>


	<div class="main">
	  <h2>Device Motion</h2>
	  <table>
	    <tr>
	      <td>Event Supported</td>
	      <td id="dmEvent"></td>
	    </tr>
	    <tr>
	      <td>acceleration</td>
	      <td id="acc"></td>
	    </tr>
	    <tr>
	      <td>magnitude</td>
	      <td id="magnitude"></td>
	    </tr>
	    <tr>
	      <td>interval</td>
	      <td id="moInterval"></td>
	    </tr>
	    <tr>
	      <td>geolocation</td>
	      <td id="geo"></td>
	    </tr>
	    <tr>
	      <td>timeStamp</td>
	      <td id="timestamp"></td>
	    </tr>
	  </table>
	</div>

	<script>
		

		function getLocation() {
		  if (navigator.geolocation) {
		    navigator.geolocation.getCurrentPosition(function(position){
		    	document.getElementById("geo").innerHTML= position.coords.longitude + "," + position.coords.latitude;
		    });
		  }
		  else {
		  	document.getElementById("geo").innerHTML="Geolocation is not supported by this browser.";
		   }
		}


		function getTimeStamp(){
			document.getElementById("timestamp").innerHTML = (new Date().getTime());
		}

		mcnt = 0.0;

		function deviceMotionHandler(eventData) {
		  var info, xyz = "[X, Y, Z]";

		  // Grab the acceleration from the results
		  var acc = eventData.acceleration;
		  info = xyz.replace("X", acc.x);
		  info = info.replace("Y", acc.y);
		  info = info.replace("Z", acc.z);
		  document.getElementById("acc").innerHTML = info;

		  var magnitude = Math.sqrt(acc.x*acc.x + acc.y*acc.y + acc.z*acc.z);
		  document.getElementById("magnitude").innerHTML = magnitude;

		  
		  //BUMP logic
		  if (magnitude > 1.4) {
		  	mcnt += eventData.interval;
		  }

		  if (mcnt > 1.0) {
		  	alert('BUMP!');
		  	getLocation();
		  	getTimeStamp();
		  	mcnt = 0.0;
		  }


		  // // Grab the refresh interval from the results
		  info = eventData.interval;
		  document.getElementById("moInterval").innerHTML = info;       
		};

		if (window.DeviceMotionEvent) {
		  window.addEventListener('devicemotion', deviceMotionHandler, false);
		} else {
		  document.getElementById("dmEvent").innerHTML = "Not supported."
		}



	</script>

</body>

</html>